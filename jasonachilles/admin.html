<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Jason Achilles Admin</title>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet">

<style>
/* === BODY === */
body {
  margin:0; padding:0;
  background:#000 url('https://cdn.pixabay.com/photo/2017/03/22/15/28/space-2162167_1280.jpg') center/cover no-repeat fixed;
  font-family:'Orbitron',sans-serif;
  color:#0ff;
  display:flex; justify-content:center; align-items:center;
  min-height:100vh;
}

/* === STAR WARS STYLE PASSWORD SCREEN === */
#passwordScreen {
  position:absolute; top:0; left:0; width:100%; height:100%;
  background: rgba(0,0,0,0.85);
  display:flex; flex-direction:column; justify-content:center; align-items:center;
  text-align:center;
  z-index:100;
}
#passwordScreen h1 {
  font-size:3rem; text-shadow: 0 0 10px #0ff, 0 0 30px #0ff;
  margin-bottom:30px;
}
#passwordScreen input {
  padding:12px 16px; font-size:1.2rem; border-radius:8px; border:none;
  margin-bottom:16px; width:250px; text-align:center;
}
#passwordScreen button {
  padding:12px 20px; font-size:1.2rem; font-weight:bold;
  background:#0ff; color:#000; border:none; border-radius:8px;
  cursor:pointer; text-shadow: 0 0 5px #000;
}
#passwordScreen button:hover { background:#0cc; }

/* === ADMIN UI === */
#adminUI { display:none; flex-direction:column; align-items:center; width:100%; max-width:700px; padding:40px; background:rgba(0,0,0,0.85); border-radius:20px; box-shadow:0 0 40px #0ff; }
#adminUI h1 { text-align:center; font-size:2.5rem; margin-bottom:30px; text-shadow:0 0 10px #0ff; }
form { display:flex; flex-direction:column; gap:16px; width:100%; }
input, button { padding:12px; border-radius:8px; border:none; font-family:'Orbitron',sans-serif; font-size:1rem; }
button { background:#0ff; color:#000; font-weight:bold; cursor:pointer; transition:.2s; }
button:hover { background:#0cc; }
ul { margin-top:20px; width:100%; list-style:none; padding:0; }
li { display:flex; justify-content:space-between; align-items:center; background:rgba(0,255,255,0.1); padding:10px; margin-bottom:8px; border-radius:6px; }
li a { color:#0ff; text-decoration:none; }
li button.delete { background:#f00; color:#fff; padding:6px 12px; border-radius:6px; border:none; cursor:pointer; transition:.2s; }
li button.delete:hover { background:#c00; }
</style>
</head>

<body>

<!-- PASSWORD SCREEN -->
<div id="passwordScreen">
  <h1>Enter the Cosmic Key</h1>
  <input type="password" id="adminPassword" placeholder="Password">
  <button onclick="checkPassword()">Access Admin</button>
</div>

<!-- ADMIN UI -->
<div id="adminUI">
  <h1>Admin - Edit Shows</h1>
  <form id="addShowForm">
    <input type="text" id="showName" placeholder="Show Name" required>
    <input type="date" id="showDate" required>
    <input type="url" id="showLink" placeholder="Link to venue/info" required>
    <button type="submit">Add Show</button>
  </form>
  <ul id="currentShows"></ul>
</div>

<script>
/* === PASSWORD PROTECTION === */
const PASSWORD = "danascullyiloveu";
function checkPassword(){
  const pw = document.getElementById('adminPassword').value;
  if(pw === PASSWORD){
    document.getElementById('passwordScreen').style.display='none';
    document.getElementById('adminUI').style.display='flex';
    loadCurrentShows();
  } else {
    alert('Wrong password! The galaxy denies you entry.');
  }
}

/* === LOAD CURRENT SHOWS === */
const list = document.getElementById('currentShows');
async function loadCurrentShows(){
  try {
    const res = await fetch('shows.json');
    const shows = await res.json();
    list.innerHTML = '';
    shows.forEach((s,i)=>{
      const li = document.createElement('li');
      li.innerHTML = `<span>${s.name} - ${s.date} <a href="${s.link}" target="_blank">More info</a></span>`;
      const del = document.createElement('button');
      del.className = 'delete';
      del.textContent = 'Delete';
      del.onclick = () => deleteShow(i);
      li.appendChild(del);
      list.appendChild(li);
    });
  } catch(e){ console.error(e); list.innerHTML='<li>No shows yet.</li>'; }
}

/* === ADD SHOW === */
document.getElementById('addShowForm').addEventListener('submit', async e=>{
  e.preventDefault();
  const name = document.getElementById('showName').value;
  const date = document.getElementById('showDate').value;
  const link = document.getElementById('showLink').value;
  try {
    await fetch('/.netlify/functions/save-shows', {
      method:'POST',
      headers:{'Content-Type':'application/json','x-admin-key': PASSWORD},
      body: JSON.stringify({name,date,link})
    });
    document.getElementById('showName').value='';
    document.getElementById('showDate').value='';
    document.getElementById('showLink').value='';
    loadCurrentShows();
  } catch(err){ alert('Error saving show'); console.error(err); }
});

/* === DELETE SHOW === */
async function deleteShow(index){
  if(!confirm('Are you sure you want to delete this show?')) return;
  try {
    await fetch('/.netlify/functions/save-shows', {
      method:'POST',
      headers:{'Content-Type':'application/json','x-admin-key': PASSWORD},
      body: JSON.stringify({deleteIndex: index})
    });
    loadCurrentShows();
  } catch(err){ alert('Error deleting show'); console.error(err); }
}
</script>

</body>
</html>